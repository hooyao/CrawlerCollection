FROM python:3.6.5-stretch

MAINTAINER Hu Yao <hooyao@gmail.com>

ENV libtorrent_version=1.2.0 \
    path_ver=1_2_0 \
    CFLAGS=-lstdc++

RUN mv /etc/apt/sources.list /etc/apt/sources.list.bak
RUN echo 'deb http://mirrors.163.com/debian/  stretch main non-free contrib \
          deb http://mirrors.163.com/debian/  stretch-updates main non-free contrib \
          deb http://mirrors.163.com/debian/  stretch-backports main non-free contrib \
          deb-src http://mirrors.163.com/debian/  stretch main non-free contrib \
          deb-src http://mirrors.163.com/debian/  stretch-updates main non-free contrib \
          deb-src http://mirrors.163.com/debian/  stretch-backports main non-free contrib \
          deb http://mirrors.163.com/debian-security/  stretch/updates main non-free contrib \
          deb-src http://mirrors.163.com/debian-security/  stretch/updates main non-free contrib' > /etc/apt/sources.list

RUN apt-get update \
    && apt-get install -y build-essential checkinstall libboost-system-dev libboost-python-dev \
                       libboost-chrono-dev libboost-random-dev libssl-dev file curl tar bash\
   # && apt-get install checkinstall \
    && curl -SL https://github.com/arvidn/libtorrent/releases/download/libtorrent_${path_ver}/libtorrent-rasterbar-${libtorrent_version}.tar.gz -o libtorrent-${libtorrent_version}.tar.gz \
    && tar zxvpf libtorrent-${libtorrent_version}.tar.gz \
    && cd libtorrent-rasterbar-${libtorrent_version} \s
    && ./configure --prefix=/usr --enable-debug=no --enable-python-binding PYTHON=`which python3`\
        --with-boost-system=boost_system \
    && make -j"$(nproc)" install \
    && ldconfig /usr/lib \
    && cd .. \
    && rm -rf libtorrent-rasterbar-${libtorrent_version} \
    && rm -f libtorrent-${libtorrent_version}.tar.gz \
    && apt-get autoremove -y \
    && apt-get clean

RUN ln -fs /usr/share/zoneinfo/Asia/Shanghai /etc/localtime
RUN dpkg-reconfigure -f noninteractive tzdata